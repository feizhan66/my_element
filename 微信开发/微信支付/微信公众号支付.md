# 微信公众号支付开发步骤


## 申请 & 配置

- 申请一个公众号，并且开通公众号支付（个人类型公众号不允许申请微信支付，建议是企业的服务号）

- 在微信商户平台(pay.weixin.qq.com)配置公众号支付目录。
 * 路径：商户平台-->产品中心-->开发配置
 * 注意：公众号支付在请求支付的时候会校验请求来源是否有在商户平台做了配置，所以必须确保支付目录已经正确的被配置，否则将验证失败，请求支付不成功

- 设置授权域名
> 开发公众号支付时，在统一下单接口中要求必传用户openid，而获取openid则需要您在公众平台设置获取openid的域名，只有被设置过的域名才是一个有效的获取openid的域名，否则将获取失败。具体界面如图所示：

![image](https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_3_2.png)


## 微信支付业务流程
![image](https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_4_1.png)



## 下单流程

- 统一下单
> 应用场景：
除被扫支付场景以外，商户系统先调用该接口在微信支付服务后台生成预支付交易单，返回正确的预支付交易会话标识后再按扫码、JSAPI、APP等不同场景生成交易串调起支付

> 状态机：
![image](https://pay.weixin.qq.com/wiki/doc/api/img/chapter9_1_0.jpg)

- 支付结果回调

- 查询订单











